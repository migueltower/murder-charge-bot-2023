name: Delete Workflow Runs

on:
  workflow_dispatch:

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Delete old workflow runs
        env:
          GH_PAT: ${{ secrets.GH_TOKENN }}
          REPO: ${{ github.repository }}
        run: |
          echo "Getting workflow runs for $REPO"
          RUNS=$(curl -s -H "Authorization: Bearer $GH_PAT" -H "Accept: application/vnd.github+json" \
            "https://api.github.com/repos/$REPO/actions/runs?per_page=100" | jq '.workflow_runs[].id')

          for RUN_ID in $RUNS; do
            echo "Deleting run $RUN_ID"
            curl -s -X DELETE -H "Authorization: Bearer $GH_PAT" -H "Accept: application/vnd.github+json" \
              "https://api.github.com/repos/$REPO/actions/runs/$RUN_ID"
          done
