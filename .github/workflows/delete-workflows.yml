name: Delete All Workflow Runs

on:
  workflow_dispatch:

jobs:
  delete-all:
    runs-on: ubuntu-latest
    steps:
      - name: Delete all workflow runs in every page
        env:
          GH_PAT: ${{ secrets.GH_PAT }}
          REPO: ${{ github.repository }}
        run: |
          echo "üîç Deleting all workflow runs for $REPO..."
          PAGE=1

          while true; do
            echo "Fetching page $PAGE..."
            RESPONSE=$(curl -s -H "Authorization: Bearer $GH_TOKENN" \
              -H "Accept: application/vnd.github+json" \
              "https://api.github.com/repos/$REPO/actions/runs?per_page=100&page=$PAGE")

            RUN_IDS=$(echo "$RESPONSE" | jq '.workflow_runs | select(. != null) | .[].id')

            if [ -z "$RUN_IDS" ]; then
              echo "‚úÖ No more workflow runs found."
              break
            fi

            for RUN_ID in $RUN_IDS; do
              echo "üóëÔ∏è Deleting run ID: $RUN_ID"
              curl -s -X DELETE -H "Authorization: Bearer $GH_PAT" \
                -H "Accept: application/vnd.github+json" \
                "https://api.github.com/repos/$REPO/actions/runs/$RUN_ID"
            done

            PAGE=$((PAGE + 1))
            sleep 1  # avoid rate limits
          done
